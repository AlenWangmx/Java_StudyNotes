# Maven依赖管理、项目构建工具

## 一、Maven依赖传递特性

### （一）概念

假设有Maven项目A，项目B依赖A，项目C依赖B。那么我们可以说C依赖A。也就是说，依赖关系为：C—>B—>A；那么我们执行项目C时，会自动把A、B都下载导入到C项目的jar包目录中，这就是依赖的**传递性**

* 案例：导入jackson依赖；分析：jackson需要三个依赖
  ![1709910492299](image/Maven基础02/1709910492299.png)
* 依赖传递关系：databind依赖另外两个依赖
  ![1709910686120](image/Maven基础02/1709910686120.png)
* 最佳导入方式：只需要导入databind，可以自动传递另外两个依赖（下图中maven_A依赖maven_B）
  ![1709910995968](image/Maven基础02/1709910995968.png)

* **传递的作用**

  * 简化依赖导入过程
  * 确保依赖版本正确
* **传递的原则**

  * 在A依赖B，B依赖C的前提下（A—>B—>C），C是否能够传递到A，取决于B依赖C时使用的依赖范围以及配置
    * B依赖C时使用**compile范围**：可以传递
    * B依赖C时使用**test**或**provided范围**：不能传递，所以需要这样的jar包时，就必须在需要的地方明确配置依赖才可以
    * B依赖C时，若配置了以下标签，则不能传递（**optional标签**可以终止依赖传递）

  ```xml
  <dependency>
      <groupId>com.alibaba</groupId>
      <artifactId>druid</artifactId>
      <version>1.2.8</version>
      <!--有此标签时不可传递-->
      <optional>true</optional>
  </dependency>
  ```

### （二）依赖传递终止

* 非compile范围进行依赖传递
* 使用optional配置终止传递
* 依赖冲突（传递的依赖已经存在）

### （三）依赖冲突

#### 1、依赖冲突特性

* 当一个项目直接或者间接引用（依赖传递）出现了相同的jar包，这时项目会出现jar包重复，这就是 **“冲突”**！依赖冲突避免出现重复依赖，并且终止依赖传递！
  ![1709911832891](image/Maven基础02/1709911832891.png)
* maven有自动解决依赖冲突问题的能力，会按照自己的原则，进行重复依赖选择。同时也提供了手动解决冲突的方法（不过不推荐手动解决）

#### 2、解决依赖冲突（如何选择重复依赖）方式

1. 自动选择原则

   * 短路优先原则
     * A——>B——>C——>D——>E——>X(version 0.0.1)
     * A——>F——>X(version 0.0.2)
     * 则A依赖于X（version 0.0.2）
   * 依赖路径长度相同的情况下，则“先声明优先”（第二原则）
     * A——>E——>X(version 0.0.1)
     * A——>F——>X(version 0.0.2)
     * 在A的\<dependies></dependies>中先声明的依赖，如果路径长度相同会优先选择（如：先声明E再声明F，会优先使用E中的version 0.0.1）！
2. 手动排除

   * 在对应依赖的\<dependency>标签中使用\<exclusions>标签排除依赖

   ```xml
   <!--排除了druid依赖-->
   <dependencies>
        <dependency>
            <g..>中间依赖...</g>
            <a..>...</a>
            <v..>...</v>
            <!--依赖排除-->
            <exclusions>
                <exclusion>
                    <grounpId>com.alibaba</grounpId>
                    <artifactId>druid</artifactId>
                </exclusion>
            </exclusions>
        </dependecy>
    </dependencies>
   ```

## 二、Maven工程继承和聚合关系

### （一）Maven工程继承关系

#### 1、继承概念

Maven继承是指在Maven的项目中，让一个项目从另一个项目中继承配置信息的机制。继承可以让我们在多个项目中共享同一配置信息，简化项目的管理和维护工作

#### 2、继承作用

在父工程中统一管理项目中的依赖信息

* 它的背景是：
  * 对一个比较大的项目进行了模块拆分
  * 一个project下面，创建了很多个module
  * 每一个module都需要配置自己的依赖信息
* 它背后的需求：
  * 在每一个module中各自维护各自的依赖信息很容易发生出入，不易统一管理
  * 使用同一个框架内的不同jar包，它们应该是同一个版本，所以整个项目中使用的框架版本需要统一
  * 使用框架时所需要的jar包组合（或者说是依赖组合）需要经过长期摸索和反复调试，最终确定一个可用组合。这个耗费很大经历总结出来的方案不应该在新的项目中重新摸索
  * 通过在父工程中为整个项目维护依赖信息的组合既保证了整个项目使用规范、准确的jar包；又能够将以往的经验沉淀下来，节约时间和经历

#### 3、继承语法

* 父工程
